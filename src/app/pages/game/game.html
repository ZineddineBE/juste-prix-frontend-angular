<div class="container mt-5 col-12 col-md-8 col-lg-6">
  
  @if (produitsSession().length > 0) {
    
    @if (gameState() === 'play') {
      <mat-card class="text-center shadow">
        <mat-card-header class="justify-content-center">
          <mat-card-title class="display-6">{{ produitsSession()[this.currentIndex()].nom }}</mat-card-title>
        </mat-card-header>
        
        <img mat-card-image [src]="produitsSession()[this.currentIndex()].url" alt="Produit" class="p-3 mx-auto" style="max-height: 300px; object-fit: contain;">
        
        <mat-card-content class="mt-4">
          <p class="text-muted">Produit {{ currentIndex() + 1 }} sur {{ produitsSession().length }}</p>
          <mat-form-field appearance="outline" class="w-75">
            <mat-label>Votre estimation</mat-label>
            <input matInput type="number" [(ngModel)]="prixSaisi" placeholder="0.00">
            <span matTextSuffix>€</span>
          </mat-form-field>
        </mat-card-content>
        
        <mat-card-actions class="justify-content-center pb-4">
          <button mat-raised-button color="primary" class="w-50" (click)="validerPrix()" [disabled]="!prixSaisi()">
            Envoyer
          </button>
        </mat-card-actions>
      </mat-card>
    }

    @else if (gameState() === 'result') {
      <mat-card class="text-center shadow border-primary">
        <mat-card-header class="justify-content-center">
          <mat-card-title class="display-6">{{ produitsSession()[this.currentIndex()].nom }}</mat-card-title>
        </mat-card-header>
        
        <img mat-card-image [src]="produitsSession()[this.currentIndex()].url" alt="Produit" class="p-3 mx-auto opacity-75" style="max-height: 200px; object-fit: contain;">
        
        <mat-card-content class="mt-3">
          <h2 class="text-success fw-bold">Prix réel : {{ produitsSession()[this.currentIndex()].prix }} €</h2>
          <h3 class="text-primary mt-3">+ {{ pointsDernierTour() }} points !</h3>
          <p class="text-muted">Score total : {{ scoreTotal() }}</p>
        </mat-card-content>
        
        <mat-card-actions class="justify-content-center pb-4">
          <button mat-raised-button color="accent" class="w-50" (click)="continuer()">
            Continuer
          </button>
        </mat-card-actions>
      </mat-card>
    }

    @else if (gameState() === 'leaderboard') {
      <mat-card class="shadow">
        <mat-card-header class="justify-content-center bg-primary text-white py-3 rounded-top">
          <mat-card-title class="m-0"><i class="fa fa-trophy me-2"></i> Classement Final</mat-card-title>
        </mat-card-header>
        
        <mat-card-content class="pt-4">
          <ul class="list-group list-group-flush">
            @for (participant of session.participants; track $index) {
              
              @if (participant.score !== undefined) {
                <li class="list-group-item d-flex justify-content-between align-items-center fs-5">
                  <span><i class="fa fa-user me-2 text-muted"></i> {{ participant.utilisateur }}</span>
                  <span class="badge bg-primary rounded-pill">{{ participant.score }} pts</span>
                </li>
              }
              
            } @empty {
              <li class="list-group-item text-center text-muted">Aucun score enregistré pour le moment.</li>
            }
          </ul>
        </mat-card-content>

        <mat-card-actions class="justify-content-center pb-4 mt-3">
          <button mat-raised-button routerLink="/home" color="warn">Retour à l'accueil</button>
        </mat-card-actions>
      </mat-card>
    }

  } @else {
    <div class="text-center mt-5">
      <div class="spinner-border text-primary" role="status"></div>
      <p class="mt-3">Chargement du jeu...</p>
    </div>
  }
</div>
